<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>War Game Online - Firebase テスト</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
</head>
<body>
  <h1>War Game Online - Firebase 接続テスト</h1>

  <p>
    下のボタンで Firestore への書き込み・読み取りテストができます。<br />
    ※まだゲーム本体はつなげず、「通信テスト用のページ」です。
  </p>

  <button id="saveBtn">テストデータを書き込む</button>
  <button id="loadBtn">最新データを読む</button>

  <pre id="result" style="white-space: pre-wrap; background: #f5f5f5; padding: 8px;"></pre>

  <!-- Firebase を CDN 経由で読み込む -->
  <script type="module">
    // ★バージョン 12.6.0 で統一
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
    import {
      getFirestore,
      collection,
      addDoc,
      getDocs,
      query,
      orderBy,
      limit,
    } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-firestore.js";

    // ===== ここに Firebase コンソールに表示されていた firebaseConfig を貼り付けてください =====
    // Firebase コンソール:
    // プロジェクト概要 → war-game-web → 歯車アイコン → アプリの設定
    // → 「Firebase SDK snippet」→「構成」
    const firebaseConfig = {
    apiKey: "AIzaSyDllHnBnkhRFYFeDJtAQmVjMOLwUv5gSyE",
    authDomain: "war-game-online-77a9a.firebaseapp.com",
    projectId: "war-game-online-77a9a",
    storageBucket: "war-game-online-77a9a.firebasestorage.app",
    messagingSenderId: "851982602094",
    appId: "1:851982602094:web:906903954159882bbbfb7f",
    measurementId: "G-GYW85JHDGQ"
    };
    // ========================================================================

    // Firebase 初期化
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const resultEl = document.getElementById("result");
    const saveBtn = document.getElementById("saveBtn");
    const loadBtn = document.getElementById("loadBtn");

    // Firestore にテストデータを書き込み
    saveBtn.addEventListener("click", async () => {
      try {
        const now = Date.now();
        const docRef = await addDoc(collection(db, "debug-test"), {
          createdAt: now,
          message: "Hello from GitHub Pages!",
        });
        resultEl.textContent =
          "書き込み OK\nドキュメントID: " +
          docRef.id +
          "\ncreatedAt: " +
          new Date(now).toLocaleString("ja-JP");
      } catch (e) {
        console.error(e);
        resultEl.textContent = "書き込みエラー:\n" + e;
      }
    });

    // Firestore から最新データを読む
    loadBtn.addEventListener("click", async () => {
      try {
        const q = query(
          collection(db, "debug-test"),
          orderBy("createdAt", "desc"),
          limit(5)
        );
        const snap = await getDocs(q);

        const lines = [];
        snap.forEach((doc) => {
          const d = doc.data();
          const timeText = d.createdAt
            ? new Date(d.createdAt).toLocaleString("ja-JP")
            : "(createdAt 不明)";
          lines.push(`${doc.id} | ${timeText} | ${d.message}`);
        });

        resultEl.textContent =
          "読み取り OK\n" + (lines.join("\n") || "(データがまだありません)");
      } catch (e) {
        console.error(e);
        resultEl.textContent = "読み取りエラー:\n" + e;
      }
    });
  </script>
</body>
</html>
